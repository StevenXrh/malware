import json
import time

import requests


class VirustotalUtils():
    def __init__(self, md5):
        self.apikey = '2219835eefb5e7c51286b43eed03715a54c979b878ef36cb5b7a50ce08fa6b1e'
        self.url = 'https://www.virustotal.com/vtapi/v2/file/report'
        self.md5 = md5

    def api_utils(self):
        param = {
            'resource': self.md5,
            'apikey': self.apikey,
            'allinfo': '1'
        }
        r = requests.post(url=self.url, data=param)
        time.sleep(15)
        jsondata = json.loads(r.text)
        scans = jsondata['scans']
        result = [self.md5]

        for key in scans:
            if scans[key]['result'] is None:
                continue
            else:
                result.append('\t'+key + ':' + scans[key]['result'])
        return result
